# RAG Evaluation Workflow

Visual guide to the complete workflow.

## Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        YOUR LOCAL MACHINE                          â”‚
â”‚                                                                    â”‚
â”‚  Step 1: Prepare Datasets                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ $ python prepare_datasets_local.py                       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ â€¢ Downloads from HuggingFace/Kaggle/DPR                  â”‚    â”‚
â”‚  â”‚ â€¢ Converts to .source/.target format                     â”‚    â”‚
â”‚  â”‚ â€¢ Uses your local Python environment                     â”‚    â”‚
â”‚  â”‚ â€¢ Works with newer dependencies                          â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ Output: eval_datasets/*.source, *.target                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†“                                     â”‚
â”‚  Step 2: Upload to Modal                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ $ bash upload_datasets_to_modal.sh                       â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ â€¢ Uploads .source and .target files                      â”‚    â”‚
â”‚  â”‚ â€¢ Plain text â†’ works everywhere                          â”‚    â”‚
â”‚  â”‚ â€¢ One-time per dataset                                   â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ Destination: Modal volume "rag-data"                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ Upload via Modal CLI
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MODAL VOLUME                               â”‚
â”‚                                                                    â”‚
â”‚  Volume: rag-data                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ eval_datasets/                                           â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ nq_test.source              (234 KB)                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ nq_test.target              (456 KB)                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ triviaqa_test.source        (678 KB)                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ triviaqa_test.target        (1.2 MB)                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ webquestions_test.source    (123 KB)                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ webquestions_test.target    (234 KB)                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ curatedtrec_test.source     (45 KB)                  â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ curatedtrec_test.target     (89 KB)                  â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ msmarco_test.source         (5.6 MB)                 â”‚    â”‚
â”‚  â”‚ â””â”€â”€ msmarco_test.target         (11.2 MB)                â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ âœ“ Persistent storage                                     â”‚    â”‚
â”‚  â”‚ âœ“ Shared across all Modal runs                           â”‚    â”‚
â”‚  â”‚ âœ“ Accessible by entire team                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ Read by Modal container
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MODAL CONTAINER                               â”‚
â”‚                     (Serverless, GPU-enabled)                      â”‚
â”‚                                                                    â”‚
â”‚  Step 3: Run Evaluation                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ $ modal run modal_rag_eval.py --test-mode                â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ 1. Detects pre-uploaded datasets âœ“                       â”‚    â”‚
â”‚  â”‚ 2. Skips download/preparation                            â”‚    â”‚
â”‚  â”‚ 3. Loads RAG models (facebook/rag-sequence-nq)           â”‚    â”‚
â”‚  â”‚ 4. Downloads Wikipedia index (~80GB, cached)             â”‚    â”‚
â”‚  â”‚ 5. Runs evaluation on all datasets                       â”‚    â”‚
â”‚  â”‚ 6. Computes metrics (EM, F1)                             â”‚    â”‚
â”‚  â”‚ 7. Saves results to volume                               â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ Output: results/evaluation_results.json                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ Save to volume
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MODAL VOLUME                               â”‚
â”‚                                                                    â”‚
â”‚  Volume: rag-data                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ results/                                                 â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ evaluation_results.json                              â”‚    â”‚
â”‚  â”‚ â”œâ”€â”€ evaluation.log                                       â”‚    â”‚
â”‚  â”‚ â””â”€â”€ dataset_preparation_results.json                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ Download
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        YOUR LOCAL MACHINE                          â”‚
â”‚                                                                    â”‚
â”‚  Step 4: Get Results                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ $ modal volume get rag-data results/ ./results/          â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ Downloads:                                               â”‚    â”‚
â”‚  â”‚ â€¢ evaluation_results.json (metrics)                      â”‚    â”‚
â”‚  â”‚ â€¢ evaluation.log (full output)                           â”‚    â”‚
â”‚  â”‚                                                          â”‚    â”‚
â”‚  â”‚ Analyze, share, compare with paper results               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Why This Workflow?

### âŒ Old Approach (In-container preparation)
```
Modal Container
â”œâ”€â”€ Download datasets (complex, version conflicts)
â”œâ”€â”€ Convert to format (dependencies issues)
â”œâ”€â”€ Hope everything works (fragile)
â””â”€â”€ Run evaluation
```

**Problems**:
- datasets==1.18.0 incompatibilities
- Microsoft blob 409 errors
- Glob pattern failures
- Different behavior than local

### âœ… New Approach (Pre-upload)
```
Local Machine
â”œâ”€â”€ Download with latest dependencies âœ“
â”œâ”€â”€ Convert to plain text format âœ“
â””â”€â”€ Upload to Modal âœ“

Modal Container
â”œâ”€â”€ Load pre-uploaded files âœ“
â””â”€â”€ Run evaluation âœ“
```

**Benefits**:
- No dependency conflicts
- Faster evaluation (no download)
- Reproducible across team
- Can verify datasets locally

## Team Collaboration

### Scenario 1: First Person Sets Up

```
Alice (First time):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Alice's Machine â”‚
â”‚                 â”‚
â”‚ 1. Clone repo   â”‚
â”‚ 2. Prepare data â”‚  â†’ python prepare_datasets_local.py
â”‚ 3. Upload       â”‚  â†’ bash upload_datasets_to_modal.sh
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modal Volume   â”‚  â† Datasets now available
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Scenario 2: Others Just Use It

```
Bob, Carol, Dave:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modal Volume   â”‚  â† Datasets already there
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Their Machines  â”‚
â”‚                 â”‚
â”‚ 1. Clone repo   â”‚
â”‚ 2. Run eval     â”‚  â†’ modal run modal_rag_eval.py
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**No need to download datasets again!**

## Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ First Person (Alice)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ 0 min   â”‚ Setup environment                                 â”‚
â”‚         â”‚ â€¢ Clone repo                                       â”‚
â”‚         â”‚ â€¢ Install dependencies                             â”‚
â”‚         â”‚ â€¢ Modal setup                                      â”‚
â”‚         â”‚                                                    â”‚
â”‚ 10 min  â”‚ Prepare datasets                                  â”‚
â”‚         â”‚ â€¢ python prepare_datasets_local.py                â”‚
â”‚         â”‚ â€¢ Downloads from internet                         â”‚
â”‚         â”‚ â€¢ Converts to format                              â”‚
â”‚         â”‚                                                    â”‚
â”‚ 30 min  â”‚ Upload to Modal                                   â”‚
â”‚         â”‚ â€¢ bash upload_datasets_to_modal.sh                â”‚
â”‚         â”‚ â€¢ Uploads ~50 MB of text files                     â”‚
â”‚         â”‚                                                    â”‚
â”‚ 35 min  â”‚ Test evaluation                                   â”‚
â”‚         â”‚ â€¢ modal run modal_rag_eval.py --test-mode         â”‚
â”‚         â”‚ â€¢ Verifies everything works                       â”‚
â”‚         â”‚                                                    â”‚
â”‚ 40 min  â”‚ âœ“ Ready for team!                                 â”‚
â”‚         â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Everyone Else (Bob, Carol, Dave)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ 0 min   â”‚ Setup environment                                 â”‚
â”‚         â”‚ â€¢ Clone repo                                       â”‚
â”‚         â”‚ â€¢ Install modal                                    â”‚
â”‚         â”‚ â€¢ Modal setup                                      â”‚
â”‚         â”‚                                                    â”‚
â”‚ 10 min  â”‚ Run evaluation                                    â”‚
â”‚         â”‚ â€¢ modal run modal_rag_eval.py --test-mode         â”‚
â”‚         â”‚ â€¢ Uses Alice's uploaded datasets                  â”‚
â”‚         â”‚                                                    â”‚
â”‚ 15 min  â”‚ âœ“ Working!                                        â”‚
â”‚         â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
Internet Sources                Local Processing           Modal Volume
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚               â”‚              â”‚          â”‚              â”‚
â”‚ HuggingFace  â”‚â”€â”€â”€downloadâ”€â”€â”€â†’â”‚   Python     â”‚â”€â”€uploadâ†’ â”‚  Persistent  â”‚
â”‚ (datasets)   â”‚               â”‚   Script     â”‚          â”‚   Storage    â”‚
â”‚              â”‚               â”‚              â”‚          â”‚              â”‚
â”‚ DPR/Meta     â”‚â”€â”€â”€downloadâ”€â”€â”€â†’â”‚   Converts   â”‚â”€â”€uploadâ†’ â”‚  Text Files  â”‚
â”‚ (NQ, etc)    â”‚               â”‚   to .source â”‚          â”‚  (.source/   â”‚
â”‚              â”‚               â”‚   & .target  â”‚          â”‚   .target)   â”‚
â”‚ Kaggle       â”‚â”€â”€â”€downloadâ”€â”€â”€â†’â”‚              â”‚â”€â”€uploadâ†’ â”‚              â”‚
â”‚ (MS-MARCO)   â”‚               â”‚              â”‚          â”‚              â”‚
â”‚              â”‚               â”‚              â”‚          â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                 â”‚
                                                                 â”‚ Mount
                                                                 â†“
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”‚    Modal     â”‚
                                                          â”‚  Container   â”‚
                                                          â”‚              â”‚
                                                          â”‚  RAG Model   â”‚
                                                          â”‚  + Index     â”‚
                                                          â”‚  â†’ Results   â”‚
                                                          â”‚              â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Format

### Input Files (what you prepare locally)

```
eval_datasets/nq_test.source:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ when did the us break away from england â”‚  â† One question per line
â”‚ who starred in the original oceans 11   â”‚  â† Plain text, UTF-8
â”‚ ...                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

eval_datasets/nq_test.target:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ when did the us break away from england\t['July 4, 1776']        â”‚  â† Tab-separated
â”‚ who starred in the original oceans 11\t['Frank Sinatra', ...]    â”‚  â† Question + answers
â”‚ ...                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Output Files (what evaluation produces)

```json
results/evaluation_results.json:
{
  "nq": {
    "exact_match": 0.442,
    "f1": 0.521,
    "samples": 3610
  },
  "triviaqa": {
    "exact_match": 0.564,
    "f1": 0.613,
    "samples": 11313
  },
  ...
}
```

## Summary

**3 Simple Steps**:
1. ğŸ“¥ Prepare locally (handles complexity)
2. â¬†ï¸ Upload to Modal (one-time)
3. ğŸš€ Run evaluation (fast, reliable)

**Key Insight**: By separating data preparation from evaluation, we avoid environment conflicts and enable easy team collaboration.
